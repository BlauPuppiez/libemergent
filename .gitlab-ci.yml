stages:
  - build
  - deploy

build-check:
  stage: build
  only: [ master ]
  script:
    - earthly +build

package-all:
  stage: build
  only: [ tags ]
  script:
    - earthly +package
  artifacts:
    paths:
      - build/**.deb

deploy-packages:
  stage: deploy
  when: on_success
  only: [ tags ]
  dependencies: [ package-all ]
  script:
    # - scp libemergent-dev_*.deb $DEPLOY_DOWNLOADS/libemergent/
    - for REPO in bionic focal jammy; do
        phi-deploy build/libemergent-dev_*.deb $REPO oss;
      done
